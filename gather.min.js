(function(){window.GLOBAL_RETRIEVAL_BOOKMARKLET_SCRIPT={version:"0.5",scriptString:'(function(){function e(e){var t,n,i,l;if(e.length>2e3){for(n={},t=JSON.parse(e),i=0;i<t.location.length&&!(t.location[i].search(/Closed|Reference/)>-1);i+=1);l=i||0;for(i in t)n[i]="[object Array]"===Object.prototype.toString.call(t[i])?[t[i][l]]:t[i];alert("Unfortunately the list of items was too long and the first listed item will be offered in the next window.  Please give more specific instructions in the notes field of the form if this item is not what you need."),e=JSON.stringify(n)}return e}function t(t){t=e(t),window.prompt("Copy to clipboard: Ctrl+C, Enter",t)}function n(){alert("There are no available copies of this title.")}function i(e){return new RegExp("^"+e.replace(/\\./g,"\\\\.").replace(/\\//g,"\\\\/"))}function l(){var e,i,l,r,a,o,c,g,h=document.createElement("div");h.innerHTML=this.responseText;var u=h.getElementsByTagName("h1");for(s.title=$(h).find("div.back_container a").html().trim(),s.title=s.title.slice(s.title.search("Back to")+8),o=0;o<u.length;o+=1)if(g=u[o].getAttribute("class")||u[o].className,"group_heading"===g&&-1===u[o].innerHTML.search("Not available at this time")){for(e=u[o].nextSibling;"TABLE"!==e.tagName;)e=e.nextSibling;for(i=e.getElementsByTagName("th"),l=e.getElementsByTagName("td"),c=0;c<i.length;c+=1)switch(i[c].innerHTML){case"Collection":r=c;break;case"Call Number":a=c;break;case"Call No.":a=c}for(c=0;c<l.length;c+=i.length)void 0!==r&&l[c+r].innerHTML.indexOf("Central")>-1&&f(l[c+r].innerHTML+l[c+a].innerHTML)&&(s.location.push(m(l[c+r].innerHTML)),void 0!==a&&s.callNumber.push(m(l[c+a].innerHTML)))}return s.location.length<1?void n():void t(JSON.stringify(s))}function r(){var e=document.createElement("div");e.innerHTML=this.responseText;var i,l,r,a=e.getElementsByTagName("table")[0],o=a.getElementsByTagName("td");for(i=0;i<o.length;i+=3)l=m(o[i].innerHTML),r=o[i+1].getElementsByTagName("a"),0!==r.length&&(r=r[0].innerHTML,o[i].innerHTML.indexOf("Central")>-1&&f(l+r)&&(s.location[s.location.length]=l,s.callNumber[s.callNumber.length]=r));return s.location.length<1?void n():void t(JSON.stringify(s))}var a,o=document.URL,c="https://multcolib.bibliocommons.com",g="http://catalog.multcolib.org",s={location:[],callNumber:[],title:""},m=function(e){return e.replace(/<!-- field v.+$/,"").replace(/^\\s+|[\\s-]+$|<!--[\\w\\s]+-->|<[^>]+>|&nbsp;\\s?/g,"").replace("&","&").replace(/\\s+$/,"")},f=function(){var e=[];return function(t){for(var n=0,i=e.length;i>n;n+=1)if(e[n]===t)return!1;return e[i]=t,!0}}();if(o.match(i(c)))o=c+document.getElementById("circ_info_trigger").getAttribute("href"),a=new XMLHttpRequest,a.onload=l,a.open("get",o,!0),a.send();else if(o.match(i(g))){var h,u,d,T=document.getElementsByTagName("td"),b=document.getElementsByTagName("form"),N=!1;for(u=0;u<T.length;u+=1)if("Title"===T[u].innerHTML){s.title=m(T[u+1].innerHTML);break}for(u=0;u<b.length;u+=1){for(h=b[u].getElementsByTagName("input"),d=0;d<h.length;d+=1)if(h[d].getAttribute("value")&&h[d].getAttribute("value").indexOf("View additional copies")>-1){N=!0,o=b[u].getAttribute("action"),a=new XMLHttpRequest,a.onload=r,a.open("post",o),a.send();break}if(N)break}if(!N){var p,L,y,H=document.getElementsByTagName("table");for(u=0;u<H.length;u+=1)if("bibItems"===H[u].className)for(p=H[u].getElementsByTagName("tr"),d=0;d<p.length;d+=1)T=p[d].getElementsByTagName("td"),0!==T.length&&(L=m(T[0].innerHTML),y=m(T[1].innerHTML),console.log(T[1].innerHTML),T.length>0&&T[0].innerHTML.indexOf("Central")>-1&&-1===T[2].innerHTML.indexOf("DUE")&&f(L+y)&&(s.location[s.location.length]=L,s.callNumber[s.callNumber.length]=y));else"bibHoldings"===H[u].className&&(p=H[u].getElementsByTagName("tr"),Array.prototype.forEach.call(p,function(e,t,n){T=e.getElementsByTagName("td"),0!==T.length&&T[0].innerHTML.indexOf("Call No.")>-1&&T[1].innerHTML.indexOf("Periodical")>-1&&n[t+1].innerHTML.indexOf("Central")>-1&&(s.callNumber[s.callNumber.length]=m(T[1].innerHTML),s.location[s.location.length]=m(n[t+1].getElementsByTagName("td")[1].innerHTML))}));if(s.location.length<1)return void n();t(JSON.stringify(s))}}})();'}})()